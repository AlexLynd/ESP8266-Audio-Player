<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <link type="text/css" rel="stylesheet" href="style.css"  media="screen,projection"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Karla:wght@300&display=swap" rel="stylesheet">
  </head>
  <body onload= "javascript: loadFiles()">
    <div class="container player">
      <div style="margin:20px 0; float: right">
      <a class="waves-effect waves-light btn blue-grey"><i class="material-icons left">battery_std</i>100%</a>
      </div>
      <div style="margin:20px 0; float: left">
      <a class="waves-effect waves-light btn blue-grey" href="/edit">Edit MP3 List</a>
      </div>
    <table>
      <thead>
        <tr>
            <th>File</th>
            <th>Number</th>
        </tr>
      </thead>

      <tbody id="table">
      </tbody>
    </table>

    <center><p>Made be <a href="http://alexlynd.com" target="_blank">Alex Lynd</a> and <a href="https://www.youtube.com/channel/UCh8PkBLmPQ7McdFxqxAwmPg" target="_blank">Eddie</a></p></center>

    </div>
    <div id="pad"></div>

    <div class="container player-nav grey darken-4">
      <div class="center buttons">
        <form action="/dfplayer" method="post" onsubmit="return false">
          <button class="btn-floating btn-medium waves-effect waves-dark white" style="margin-right: 2rem;"><i class="material-icons" style="color: black" >shuffle</i></button>
          <button class="btn-floating btn-medium waves-effect waves-dark white" name ="cmd" type="submit" value=""><i class="material-icons" style="color: black">fast_rewind</i></button>
          <button class="btn-floating btn-large waves-effect waves-dark white" name ="cmd" type="submit" value="pause" onclick="updatePlayback()" id="playback"><i class="material-icons" style="color: black">play_arrow</i></button>
          <button class="btn-floating btn-medium waves-effect waves-dark white"><i class="material-icons" style="color: black">fast_forward</i></button>
          <button class="btn-floating btn-medium waves-effect waves-dark white" style="margin-left: 2rem;"><i class="material-icons" style="color: black">loop</i></button>
        </form>
        <div class="container">
          <form action="#" class="volume-slider"></form>
            <p class="range-field" style="z-index: 100;" onmouseup="test();">
              <input type="range" id="volume" min="0" max="30" />
            </p>
          </form>
        </div>

      </div>
    </div>

    <script>
    function loadFiles() {
        var rawFile = new XMLHttpRequest();
        rawFile.open("GET", "mp3.txt", false);
        rawFile.onreadystatechange = function () {
            if(rawFile.readyState === 4) {
                if(rawFile.status === 200 || rawFile.status == 0) {
                    var allText = rawFile.responseText;
                    test = allText.split("\n").filter(item => item);
                    for (i=0; i<test.length; i++) {
                      let file = document.createElement("tr");
                      let att =  document.createAttribute("onload");
                      att.value="javascript: test()"
                      file.setAttributeNode(att);
                      file.innerHTML= "<td>"+test[i].split("-")[1]+"</td><td>"+test[i].split("-")[0]+"</td>";
                      document.getElementById("table").appendChild(file);
                    }

                }
            }
        }
        rawFile.send(null);
    }


      document.getElementById("pad").style.height = document.getElementsByClassName('player-nav')[0].clientHeight;

      function updatePlayback() {
        if (document.getElementById("playback").getAttribute("value")== "pause") {
          document.getElementById("playback").setAttribute("value", "play");
          document.getElementById("playback").firstChild.innerHTML = "pause";
        }
        else {
          document.getElementById("playback").setAttribute("value","pause");
          document.getElementById("playback").firstChild.innerHTML = "play_arrow";
        }
        console.log(document.getElementById("playback").getAttribute("value"));
      }

      function test() {
          var http = new XMLHttpRequest();
          http.open("POST", "/dfPlayer", true);
          http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
          var params = "cmd="+document.getElementById("playback").getAttribute("value")+"&p1=1&p2=1";
          http.send(params);

            console.log(document.getElementsByClassName("value")[0].innerHTML);
      }

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  </body>
</html>
